# 药片装瓶系统分析

## 现有硬件限制

**可用输入**：

- 3 个按钮输入（PULSE / QD / CLR）
- 若干开关输入
- 1Hz - 10kHz 时钟源

**可用输出**：

- 6 个数码管输出
  - 其中 1 个需要手动译码
  - 5 个自动译码
- 1 个蜂鸣器

## 需求分析

输入：

- 设定总装瓶数
- 设定每瓶药片数量
- 装瓶开始信号
- 使用时钟信号模拟漏斗感应信号（可以使用开关控制停止或手动装入）
- 强制停转开关

输出：

- 数码管显示当前瓶药片数
- 数码管显示已经装瓶数
- 数码管显示工作状态：
  - SETTING     设置
    - 按钮1：增加
    - 按钮2：更改位数
    - 按钮3：
  - RUNNING     计数中
  - SWITCHING   换瓶中（此时不接受自动装装瓶信号，但是可能出现手动增加的情况导致超标错误）
    - 换瓶需要2s的延迟等待状态变化，可以用开关控制延迟过长模拟传送带停转错误
  - WARNING     警报
  - DONE        已完成
- 蜂鸣器发出（不同的）告警声
  - 开始/换瓶完毕：短暂发声
  - 装瓶完毕：持续发声
  - 单瓶超标/急停（不可恢复）：快速警报
  - 漏斗缺料/传送带停转（可恢复）：慢速警报


可能的异常：

- 漏斗缺料：长时间未收到装瓶信号
- 单瓶超标：换瓶时发现药片数量与计划数量不符
- 漏斗堵转：长时间未收到漏斗信号
- 传送带停转：传送带长时间未移动（开关模拟）
